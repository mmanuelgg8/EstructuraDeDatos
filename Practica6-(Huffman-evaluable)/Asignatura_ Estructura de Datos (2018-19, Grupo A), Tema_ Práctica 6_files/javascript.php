M.local_evlt_accessibility={DEFAULT_FONTSIZE:100,MAX_FONTSIZE:197,MIN_FONTSIZE:77,DAFAULT_PX_FONTSIZE:13,MAX_PX_FONTSIZE:26,MIN_PX_FONTSIZE:10+1,MAIN_SELECTOR:'#page',sheetnode:'',userloggedin:!1,defaultsize:null,watch:null,debug:!0,transactionsCount:0,init:function(Y,userloggedin){this.Y=Y;this.userloggedin=userloggedin;this.sheetnode=Y.one('link[href="'+M.cfg.wwwroot+'/local/evlt_accessibility/userstyles.php"]');this.defaultsize=M.local_evlt_accessibility.DEFAULT_FONTSIZE;Y.all('.evlt_accessibility_textresize').on('click',function(e){if(!e.target.hasClass('disabled')){M.local_evlt_accessibility.changesize(e.target)}});Y.all('.evlt_accessibility_changecolour').on('click',function(e){if(!e.target.hasClass('disabled')){M.local_evlt_accessibility.changecolour(e.target)}});Y.all('#local_evlt_accessibility_underline').on('click',function(e){M.local_evlt_accessibility.change_underline(e.target)});Y.all('#local_evlt_accessibility_readablefont').on('click',function(e){M.local_evlt_accessibility.change_readablefont(e.target)});Y.all('.evlt_accessibility-navbar-menu a').each(function(node){node.removeAttribute('href')})},show_message:function(msg){this.Y.one('#local_evlt_accessibility_message').setContent(msg);if(msg)setTimeout("M.local_evlt_accessibility.show_message('')",5000)},savesize:function(){this.Y.io(M.cfg.wwwroot+'/local/evlt_accessibility/database.php',{data:'op=save&size=true&scheme=true&underline=true&readablefont=true',method:'get',on:{success:function(id,o){M.local_evlt_accessibility.show_message(M.util.get_string('saved','local_evlt_accessibility'));if(M.local_evlt_accessibility.userloggedin){M.local_evlt_accessibility.toggle_textsizer('save','off')}},failure:function(id,o){alert(M.util.get_string('jsnosave','local_evlt_accessibility'))},start:M.local_evlt_accessibility.show_loading,end:M.local_evlt_accessibility.hide_loading}})},toggle_textsizer:function(id,op){var button=this.Y.one('#local_evlt_accessibility_'+id);if(op=='on'){if(button.hasClass('disabled')){button.removeClass('disabled')}}else if(op=='off'){if(!button.hasClass('disabled')){button.addClass('disabled')}}},toggle_underline:function(){var button=this.Y.one('#local_evlt_accessibility_underline');if(button.hasClass('evlt_accessibility_underline')){label=M.util.get_string('set_underline','local_evlt_accessibility');button.removeClass('evlt_accessibility_underline')}else{label=M.util.get_string('unset_underline','local_evlt_accessibility');button.addClass('evlt_accessibility_underline')}
button.setContent('<li><u>A</u></li> '+label)},toggle_readablefont:function(){var button=this.Y.one('#local_evlt_accessibility_readablefont');if(button.hasClass('evlt_accessibility_readablefont')){label=M.util.get_string('set_readablefont','local_evlt_accessibility');button.removeClass('evlt_accessibility_readablefont')}else{label=M.util.get_string('unset_readablefont','local_evlt_accessibility');button.addClass('evlt_accessibility_readablefont')}
button.setContent('<li><strong>A</strong></li> '+label)},changesize:function(button){Y=this.Y;switch(button.get('id')){case "local_evlt_accessibility_inc":Y.io(M.cfg.wwwroot+'/local/evlt_accessibility/changesize.php',{data:'op=inc&cur='+this.defaultsize,method:'get',on:{success:function(id,o){M.local_evlt_accessibility.reload_stylesheet();var new_fontsize=M.local_evlt_accessibility.get_current_fontsize(M.local_evlt_accessibility.MAIN_SELECTOR);M.local_evlt_accessibility.log('Increasing size to '+new_fontsize);var min_fontsize=M.local_evlt_accessibility.MIN_PX_FONTSIZE;var max_fontsize=M.local_evlt_accessibility.MAX_PX_FONTSIZE;if(new_fontsize==M.local_evlt_accessibility.defaultsize){M.local_evlt_accessibility.toggle_textsizer('reset','off')}else{M.local_evlt_accessibility.toggle_textsizer('reset','on')}
if(Math.ceil(new_fontsize)>=max_fontsize){M.local_evlt_accessibility.toggle_textsizer('inc','off')}
M.local_evlt_accessibility.toggle_textsizer('dec','on');if(M.local_evlt_accessibility.userloggedin){M.local_evlt_accessibility.toggle_textsizer('save','on')}},failure:function(o){alert(M.util.get_string('jsnosize','local_evlt_accessibility'))},start:M.local_evlt_accessibility.show_loading,end:M.local_evlt_accessibility.hide_loading}});break;case "local_evlt_accessibility_dec":Y.io(M.cfg.wwwroot+'/local/evlt_accessibility/changesize.php',{data:'op=dec&cur='+this.defaultsize,method:'get',on:{success:function(id,o){M.local_evlt_accessibility.reload_stylesheet();var new_fontsize=M.local_evlt_accessibility.get_current_fontsize(M.local_evlt_accessibility.MAIN_SELECTOR);M.local_evlt_accessibility.log('Decreasing size to '+new_fontsize);var min_fontsize=M.local_evlt_accessibility.MIN_PX_FONTSIZE;var max_fontsize=M.local_evlt_accessibility.MAX_PX_FONTSIZE;if(new_fontsize==M.local_evlt_accessibility.defaultsize){M.local_evlt_accessibility.toggle_textsizer('reset','off')}else{M.local_evlt_accessibility.toggle_textsizer('reset','on')}
if(new_fontsize<=min_fontsize){M.local_evlt_accessibility.toggle_textsizer('dec','off')}
M.local_evlt_accessibility.toggle_textsizer('inc','on');if(M.local_evlt_accessibility.userloggedin){M.local_evlt_accessibility.toggle_textsizer('save','on')}},failure:function(id,o){alert(M.util.get_string('jsnosize','local_evlt_accessibility'))},start:M.local_evlt_accessibility.show_loading,end:M.local_evlt_accessibility.hide_loading}});break;case "local_evlt_accessibility_reset":Y.io(M.cfg.wwwroot+'/local/evlt_accessibility/changesize.php',{data:'op=reset&cur='+this.defaultsize,method:'get',on:{success:function(id,o){M.local_evlt_accessibility.reload_stylesheet();var new_fontsize=Math.round(M.local_evlt_accessibility.get_current_fontsize(M.local_evlt_accessibility.MAIN_SELECTOR));M.local_evlt_accessibility.log('Resetting size to '+new_fontsize);var min_fontsize=M.local_evlt_accessibility.MIN_PX_FONTSIZE;var max_fontsize=M.local_evlt_accessibility.MAX_PX_FONTSIZE;M.local_evlt_accessibility.toggle_textsizer('reset','off');if(new_fontsize<=min_fontsize){M.local_evlt_accessibility.toggle_textsizer('dec','on')}else if(new_fontsize>=max_fontsize){M.local_evlt_accessibility.toggle_textsizer('inc','on')}
if(M.local_evlt_accessibility.userloggedin){M.local_evlt_accessibility.toggle_textsizer('save','on')}},failure:function(id,o){alert(M.util.get_string('jsnosize','local_evlt_accessibility'))},start:M.local_evlt_accessibility.show_loading,end:M.local_evlt_accessibility.hide_loading}});break;case "local_evlt_accessibility_underline":M.local_evlt_accessibility.toggle_underline();break;case "local_evlt_accessibility_readablefont":M.local_evlt_accessibility.toggle_readablefont();break;case "local_evlt_accessibility_save":M.local_evlt_accessibility.savesize();break}},changecolour:function(button){Y=this.Y;scheme=button.get('id').substring(31);Y.io(M.cfg.wwwroot+'/local/evlt_accessibility/changecolour.php',{data:'scheme='+scheme,method:'get',on:{success:function(id,o){M.local_evlt_accessibility.reload_stylesheet();M.local_evlt_accessibility.toggle_textsizer('colour1',scheme==1?'off':'on');if(M.local_evlt_accessibility.userloggedin){M.local_evlt_accessibility.toggle_textsizer('save','on')}},failure:function(id,o){alert(M.util.get_string('jsnocolour','local_evlt_accessibility'))},start:M.local_evlt_accessibility.show_loading,end:M.local_evlt_accessibility.hide_loading}})},change_underline:function(button){Y=this.Y;if(button.hasClass('evlt_accessibility_underline')){$underline=0}else{$underline=1}
Y.io(M.cfg.wwwroot+'/local/evlt_accessibility/changeunderline.php',{data:'underline='+$underline,method:'get',on:{success:function(id,o){M.local_evlt_accessibility.reload_stylesheet();M.local_evlt_accessibility.toggle_underline();if(M.local_evlt_accessibility.userloggedin){M.local_evlt_accessibility.toggle_textsizer('save','on')}},failure:function(id,o){alert(M.util.get_string('jsnounderline','local_evlt_accessibility'))},start:M.local_evlt_accessibility.show_loading,end:M.local_evlt_accessibility.hide_loading}})},change_readablefont:function(button){Y=this.Y;if(button.hasClass('evlt_accessibility_readablefont')){$readablefont=0}else{$readablefont=1}
Y.io(M.cfg.wwwroot+'/local/evlt_accessibility/changereadablefont.php',{data:'readablefont='+$readablefont,method:'get',on:{success:function(id,o){M.local_evlt_accessibility.reload_stylesheet();M.local_evlt_accessibility.toggle_readablefont();if(M.local_evlt_accessibility.userloggedin){M.local_evlt_accessibility.toggle_textsizer('save','on')}},failure:function(id,o){alert(M.util.get_string('jsnoreadablefont','local_evlt_accessibility'))},start:M.local_evlt_accessibility.show_loading,end:M.local_evlt_accessibility.hide_loading}})},log:function(data){if(this.debug){console.log(data)}},reload_stylesheet:function(){var cache_prevention_salt=new Date().getTime();var oldStylesheet=M.local_evlt_accessibility.sheetnode;var newStylesheet=null;var cssURL=M.cfg.wwwroot+'/local/evlt_accessibility/userstyles.php?&v='+cache_prevention_salt
if(document.createStyleSheet){oldStylesheet.set('href',cssURL)}else{newStylesheet=oldStylesheet.cloneNode(!0);newStylesheet.set('href',cssURL);this.Y.one('head').append(newStylesheet);newStylesheet.getDOMNode().onload=function(){oldStylesheet.remove(!0)};M.local_evlt_accessibility.sheetnode=newStylesheet}},get_current_fontsize:function(root_element){var currentsize=M.local_evlt_accessibility.DEFAULT_FONTSIZE;var defaultsize=Y.one(root_element).getComputedStyle('fontSize');if(defaultsize.substr(-2)=='px'){currentsize=defaultsize.substr(0,defaultsize.length-2)}else if(defaultsize.substr(-1)=='%'){currentsize=defaultsize.substr(0,defaultsize.length-1)}
return currentsize},show_loading:function(){this.transactionsCount++;Y.one('#loader-icon').setStyle('display','block');Y.one('.evlt_accessibility-navbar-menu').setStyle('opacity','0.2')},hide_loading:function(){if(this.transactionsCount<0)this.transactionsCount--;else this.transactionsCount=0;if(this.transactionsCount==0){Y.one('#loader-icon').setStyle('display','none');Y.one('.evlt_accessibility-navbar-menu').setStyle('opacity','1')}},}